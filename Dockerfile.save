# --- Base Image ---

# We start with a clean Ubuntu 20.04 (Focal Fossa)
FROM ubuntu:20.04

# --- Set Environment Variables ---
# Prevents services from asking interactive questions during installation
ENV DEBIAN_FRONTEND=noninteractive

# --- Install All Dependencies ---
# ADDED python3-pip to install python packages
RUN apt-get update && apt-get install -y \
    build-essential \
    cmake \
    git \
    pkg-config \
    wget \
    unzip \
    tar \
    # Eigen3 (for 3D math)
    libeigen3-dev \
    # Pangolin Dependencies (for 3D visualization)
    libglew-dev \
    libgl1-mesa-dev \
    libglu1-mesa-dev \
    libepoxy-dev \
    libpython3-dev \
    python3-setuptools \
    python3-pip \
    # OpenCV Dependencies (for image processing)
    libopencv-dev \
    python3-opencv \
    # Cleanup
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# --- ADDED: Install Python 'wheel' package ---
# This was the missing dependency from the new error log
RUN pip3 install wheel

# --- Build Pangolin from Source (in clearer steps) ---

# 1. Clone the repository
WORKDIR /root
RUN git clone --recursive https://github.com/stevenlovegrove/Pangolin.git

# 2. Configure the build using cmake
WORKDIR /root/Pangolin
RUN mkdir build && cd build && cmake .. -DCMAKE_BUILD_TYPE=Release

# 3. Compile and install the code
WORKDIR /root/Pangolin/build
RUN make -j$(nproc) && make install

# 4. Cleanup and reset working directory
WORKDIR /root
RUN rm -rf /root/Pangolin
